<div class="row my-4 mx-5"><h2>Mis datos</h2></div>

<div class="row mt-2 px-5">

  <div class="col-md-5 mb-4">

    <div class="row justify-content-center">
      <img *ngIf="person.photo_url?.length > 0 && !imgTemp" class="img-picture img-thumbnail" [src]="person.photo_url" alt="profile">
      <img *ngIf="person.photo_url?.length > 0 && imgTemp" class="img-picture img-thumbnail" [src]="imgTemp" alt="profile">
      <img *ngIf="person.photo_url?.length === 0 && !imgTemp" class="img-picture img-thumbnail" src="assets/img/no-avatar.jpg" alt="profile">
      <img *ngIf="person.photo_url?.length === 0 && imgTemp" class="img-picture img-thumbnail" [src]="imgTemp" alt="profile">
    </div>

    <div class="row justify-content-center mt-4">

      <div class="input-group mb-3 width-300">
        <div class="input-group-prepend">
            <button class="btn btn-outline-danger btn-sm" title="Borrar foto" style="width: 45px" (click)="deletePicture()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
              </svg>
            </button>
        </div>

        <div class="input-group-prepend">
          <span class="input-group-text" style="width: 45px">
            <span *ngIf="uploading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </span>
        </div>

        <div class="custom-file">
          <input type="file" class="custom-file-input" id="inputFile" accept="image/*" lang="es" (change)="changeImage($event.target.files[0])">
          <label class="custom-file-label" for="inputFile" data-browse="Cambiar">Mi foto</label>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-5 mb-4">

    <div class="form-group">
      <label for="input-name">Nombre</label>
      <input type="text" class="form-control" [class.is-invalid]="person.name?.length === 0" id="input-name"
             name="person-name" autocomplete="off" [(ngModel)]="person.name">
      <div id="input-name-validation" class="invalid-feedback">El nombre es obligatorio</div>
    </div>

    <div class="form-group">
      <label for="input-email">Correo electrónico
        <svg *ngIf="person.verified_email" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-check2-circle" viewBox="0 0 16 16">
          <path d="M2.5 8a5.5 5.5 0 0 1 8.25-4.764.5.5 0 0 0 .5-.866A6.5 6.5 0 1 0 14.5 8a.5.5 0 0 0-1 0 5.5 5.5 0 1 1-11 0z"/>
          <path d="M15.354 3.354a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l7-7z"/>
        </svg><small *ngIf="person.verified_email" title="Este correo se encuentra verificado" class="text-success"> Verificado</small>
      </label>

      <div [class.input-group]="!person.verified_email">
        <input type="text" class="form-control" [class.is-invalid]="person.email?.length === 0" id="input-email"
               name="person-email" autocomplete="off" [(ngModel)]="person.email">
        <div *ngIf="!person.verified_email" class="input-group-append">
          <button title="Enviar enlace al correo" class="btn btn-outline-success" type="button" [disabled]="loadingButton" (click)="verifyEmail()">
            <span *ngIf="loadingButton" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <span *ngIf="loadingButton" class="sr-only"></span> Verificar
          </button>
        </div>
        <div id="input-email-validation" class="invalid-feedback">El correo electrónico es obligatorio</div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-4">
        <label for="input-personal-id">Tipo</label>
        <select id="input-personal-id" class="form-control" [(ngModel)]="person.personal_id_type">
          <option *ngFor="let type of personalIdTypes" [value]="type.uid">{{ type.name }}</option>
        </select>
      </div>
      <div class="form-group col-md-8">
        <label for="input-personal-id-type">Número de identificación</label>
        <input type="text" class="form-control" id="input-personal-id-type" autocomplete="off"
               name="client-personal-id" [(ngModel)]="person.personal_id">
      </div>
    </div>

    <div class="form-group">
      <label for="input-phone">Teléfono</label>
      <input type="text" class="form-control" id="input-phone" autocomplete="off"
             name="person-phone" [(ngModel)]="person.phone">
    </div>

    <div class="form-group">
      <label for="input-bio">Sobre mi</label>
      <textarea class="form-control" id="input-bio" rows="2" name="person-bio" [(ngModel)]="person.bio"></textarea>
    </div>

    <div class="row justify-content-between px-3">
      <button class="btn btn-primary align-items-end mb-2" [disabled]="person.name?.length === 0 || person.email?.length === 0"
              (click)="updatePerson()">Actualizar datos
      </button>
      <button class="btn btn-outline-primary mb-2" (click)="openModal(passwordModal)">Cambiar contraseña</button>
    </div>
  </div>

  <div class="col-md-2 mb-4"></div>

</div>

<ng-template #passwordModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Cambiar la contraseña</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body" style="height: 25rem">

    <div class="form-group">
      <label for="input-current-password">Contraseña actual</label>
      <input type="password" class="form-control" id="input-current-password"
             name="person-current-password" [(ngModel)]="currentPassword">
    </div>

    <div class="form-group">
      <label for="input-new-password-1">Nueva contraseña</label>
      <input type="password" class="form-control" id="input-new-password-1"
             name="person-new-password-1" [(ngModel)]="newPassword1">
    </div>

    <div class="form-group">
      <label for="input-new-password-2">Confirma la contraseña</label>
      <input type="password" class="form-control" id="input-new-password-2"
             name="person-new-password-2" [(ngModel)]="newPassword2">
    </div>

  </div>

  <div class="modal-footer justify-content-end">
    <button class="btn btn-primary" [disabled]="!validatePasswords()" (click)="updatePasword()">Actualizar</button>
  </div>

</ng-template>
